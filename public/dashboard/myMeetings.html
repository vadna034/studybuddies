<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title></title>
    <meta name="description" content="yeah" />
    <meta name="keywords" content="yeah" />
    <meta name="author" content="Shane Vadnais" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="/main.css" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
      integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
  </head>
  <body>
    <section id="sideMenu">
      <nav>
        <a href="home"><i class="fa fa-home"></i>Home</a>
        <a href="addClasses">Add Classes</a>
        <a href="addMeetings">Add Meetings</a>
        <a href="myClasses">My Classes</a>
        <a href="myMeetings" class="active">My Meetings</a>
      </nav>
    </section>

    <header>
      <div class="search-area">
        <div>
          <i class="fa fa-search"></i>
          <input type="text" name="" value="" />
        </div>
      </div>

      <div class="user-area">
        <a href="#" class="add">+ add</a>
        <a href="#" class="notification">
          <i class="fa fa-bell-o" aria-hidden="true"></i>
          <span class="circle">3</span>
        </a>
        <a href="#">
          <div class="user-img"></div>
          <i class="fa fa-caret-down" aria-hidden="true"></i>
        </a>
      </div>
    </header>

    <div class="dash" id="mainClass">
      <div class="pageTitle">
        <h1>My Classes</h1>
      </div>

      <div class="card">
        <table class="table table-dark" id="meetingTable">
          <thead>
            <tr>
              <th scope="col" class="text-center">Class</th>
              <th scope="col" class="text-center">Start Time</th>
              <th scope="col" class="text-center">End Time</th>
              <th scope="col" class="text-center">Zoom Link</th>
              <th scope="col" class="text-center"></th>
            </tr>
          </thead>
        </table>
      </div>
    </div>
  </body>

  <script>
    createDeleteButton = function (id) {
      return (
        '<form name = "deleteMeeting" action="/deleteMeeting" method = "POST"><button type="submit" class="btn btn-danger" name="id" value =' +
        id +
        ">Delete</button></form>"
      );
    };

    createLeaveButton = function (id) {
      return (
        '<form name = "leaveMeeting" action="/leaveMeeting" method = "POST"><button type="submit" class="btn btn-danger" name="id" value =' +
        id +
        ">Delete</button></form>"
      );
    };

    $(document).ready(() => {
      var table = document.getElementById("meetingTable");

      fetch("/getMeetings", {
        method: "POST",
      })
        .then((response) => response.text())
        // The response is a stringified JSON object containing meeting data.
        .then((response) => {
          var meetings = JSON.parse(response);

          if (meetings.length != 0) {
            console.log("POPULATE TABLE");

            meetings.forEach((element) => {
              console.log(element);
              var addRow = table.insertRow();

              var codeCell = addRow.insertCell(0);
              codeCell.innerHTML = element.code;
              var startCell = addRow.insertCell(1);
              startCell.innerHTML = element.starttime;
              var endCell = addRow.insertCell(2);
              endCell.innerHTML = element.endtime;
              var linkCell = addRow.insertCell(3);
              linkCell.innerHTML = element.link;

              var delCell = addRow.insertCell(4);
              if (element.delete) {
                delCell.innerHTML = createDeleteButton(element.id);
              } else {
                delCell.innerHTML = createLeaveButton(element.id);
              }
            });
          } else {
            console.log("here");
            $("#mainClass")[0].innerHTML =
              "<h> You don't have any meetings yet. Check your class pages to schedule some! <h>";
          }
        })
        .catch((err) => {
          console.error("Error: ", err);
          alert("THERE WAS A SERVER ERROR. PLEASE TRY AGAIN LATER");
        });
    });
  </script>
</html>
